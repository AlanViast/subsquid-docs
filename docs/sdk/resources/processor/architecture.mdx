---
sidebar_position: 10
title: Architecture
description: Makeup of squid processors
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The processor service is a Node.js process responsible for data ingestion, transformation and data persisting into the target database. By [convention](/sdk/reference/layout), the processor entry point is at `src/main.ts`. It is run as
```bash
node lib/main.js
```

For local runs, one normally additionally exports environment variables from `.env` using `dotenv`:
```bash
node -r dotenv/config lib/main.js
```
This is what the `sqd process` shortcut does under the hood in [templates](/sdk/squid-development/#templates).

## Processor choice

The Squid SDK currently offers specialized processor classes for EVM (`EvmBatchProcessor`) and Substrate networks (`SubstrateBatchProcessor`). More networks will be supported in the future. By convention, the processor object is defined at `src/processor.ts`.

![Processor choice based on the network](</img/network-choice.png>)

Navigate to a dedicated section for each processor class:

- [`EvmBatchProcessor`](/sdk/reference/processors/evm-batch)
- [`SubstrateBatchProcessor`](/sdk/reference/processors/substrate-batch)

## Configuration

A processor instance should be configured to define the block range to be indexed, and the selectors of data to be fetched from the archive and/or a node RPC endpoint.

## `processor.run()`

The actual data processing is done by the `run()` method called on a processor instance (typically at `src/main.ts`). The method has the following signature:

```ts
run<Store>(
  db: Database<Store>,
  batchHander: (
    context: DataHandlerContext<Store, F extends FieldSelection>
  ) => Promise<void>
): void
```

The `db` parameter defines the target [data sink](/sdk/resources/store), and `batchHandler` is an `async` `void` function defining the data transformation and persistence logic. It repeatedly receives batches of archive data stored in `context.blocks`, transforms them and persists the results to the target database using the `context.store` interface.

The interface of `context` is documented on the [Common context](/sdk/reference/processor/common-context) page.

To jump straight to an example, see [Batch processor in action](/sdk/tutorials/batch-processor-in-action).
